<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>TOPSTSCHOOL Module 1 Water</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="SCHOOL_module1_water2_files/libs/clipboard/clipboard.min.js"></script>
<script src="SCHOOL_module1_water2_files/libs/quarto-html/quarto.js"></script>
<script src="SCHOOL_module1_water2_files/libs/quarto-html/popper.min.js"></script>
<script src="SCHOOL_module1_water2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SCHOOL_module1_water2_files/libs/quarto-html/anchor.min.js"></script>
<link href="SCHOOL_module1_water2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SCHOOL_module1_water2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SCHOOL_module1_water2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SCHOOL_module1_water2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SCHOOL_module1_water2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TOPSTSCHOOL Module 1 Water</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="module-1-water" class="level1">
<h1>Module 1: Water</h1>
<p>Module 1: Water is part of the Science Core Heuristics for Open Science Outcomes in Learning (SCHOOL),** a part of the NASA Transform to Open Science (TOPS) Training (TOPST) initiative.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://raw.githubusercontent.com/ciesin-geospatial/TOPSTSCHOOL/main/images/m1-banner.jpg" class="img-fluid figure-img" alt="Hands in Water"></p>
<p></p><figcaption class="figure-caption">Hands in Water</figcaption><p></p>
</figure>
</div>
</section>
<section id="code-of-conduct" class="level1">
<h1>Code of Conduct</h1>
<ul>
<li>Review other codes</li>
<li>Carpentries</li>
<li>NASA TOPS - If possible this is the default, perhaps with some edits, since we are a NASA TOPS project: <a href="https://nasa.github.io/Transform-to-Open-Science-Book/About/CODE_OF_CONDUCT.html" class="uri">https://nasa.github.io/Transform-to-Open-Science-Book/About/CODE_OF_CONDUCT.html</a></li>
<li>NASA OpenScapes.</li>
</ul>
</section>
<section id="module-1-objectives" class="level1">
<h1>Module 1 objectives</h1>
<ul>
<li><p>Students will gain an understanding of the water cycle</p>
<ul>
<li>through a written narrative about water cycle and annotated bibliography (RAs)</li>
</ul></li>
<li><p>Students will learn the role humans play in the water cycle.</p></li>
<li><p>Student will learn about water surpluses and deficits (anomalies)</p>
<ul>
<li>Introduced as written narrative</li>
<li>There is a dataset that can help us explore further</li>
</ul></li>
<li><p>Students will learn how to access WSIM-GLDAS data from the NASA SEDAC website (<a href="https://www.dante-project.org/sedacr" class="uri">https://www.dante-project.org/sedacr</a>)</p></li>
<li><p>R module (<a href="https://www.dante-project.org/sedacr" class="uri">https://www.dante-project.org/sedacr</a>) - Josh and Kytt</p></li>
<li><p>What it does - narrative</p></li>
<li><p>How to use it - code</p></li>
<li><p>Students will learn how to access MODIS NRT flood data</p></li>
<li><p>Coding to get/set date</p></li>
<li><p>Read tile map, select tile name, a</p>
<ul>
<li>Coding to add tile name to variables</li>
</ul></li>
<li><p>Students will learn how to store data locally</p></li>
<li><p>Students will learn how to subset a global data set to a predefined area of interest (AOI). (GeoBoundaries?)</p></li>
<li><p>Students will learn how to summarize the data set using an area of interest</p></li>
<li><p>Students will learn how to visualize results as maps and graphs using R(?)</p></li>
<li><p>Students will learn how to estimate impacts on populations at risk (PES, POPGRID, perhaps also infrastructure with OSM)</p></li>
<li><p>Students will learn how to share their results to the cloud (using Binder?)</p></li>
</ul>
<p><strong>Introduction</strong></p>
<p>Primary Narrative: Personal experience with water driving interaction with water datasets</p>
<p><strong>Water Cycle and Human’s place in it</strong> Water surpluses and deficits; water security Background on AOI Intro to GLDAS(?)</p>
<p>The study of Earth’s water cycle is integral to understanding the intricate relationship between human activities and this fundamental natural process. Human interventions in the water cycle have consequential impacts on oceanic, groundwater, and land processes, influencing phenomena such as droughts and floods.</p>
<p>Humans have affected the water cycle through water withdrawal, the amount of water that has been removed from its source for a specific use, and water consumption, withdrawn water that will not become available for reuse due to expiration, transpiration, drainage into the sea, or other methods of removal. Zhou et al.&nbsp;(2016) discussed estimates that over 50% of land surface globally has been affected by human activities, and found that global irrigation water consumption estimates range from 1000 to 1500 km^3/year.</p>
<p>Changes in vegetation and land cover by humans alter evapotranspiration and affect surface runoff. For example, less permeable surface, such as roads, result in faster runoff during storms and reduced infiltration, or groundwater recharge. This can cause more runoff into the ocean which would potentially increase sea surface salinity, affecting marine ecosystems, as discussed in Rothig et al.&nbsp;(2023) A study by Gordon et al.&nbsp;(2016) focuses on the marine hydrological cycle and addresses an existing study that identified sea surface salinity observations. Due to the global hydrological cycle, salty regions have become saltier and fresher regions have become fresher. Sea surface salinity can also change due to other factors such as evaporation and precipitation, and the formation and melting of sea ice.</p>
<p>Human decisions, such as allowing the growth of more wooden plants and less herbaceous plants without employing effective grassland management practices such as controlled fire and mechanical bush thinning, can contribute to phenomena such as wooden encroachment as observed in Logan et al.&nbsp;(2015). Wooden encroachment is characterized as an increase in the abundance of woody plants at the expense of herbaceous plants. Logan et al.&nbsp;(2015) demonstrate that woody encroachment results in the depletion of deeply stored water resources, whereas grasslands not experiencing such encroachment exhibit greater water use efficiency during droughts.</p>
<p>These studies contribute to an enhanced understanding of global and regional water cycles and their impact on water availability. Human activities play a pivotal role in shaping these impacts. The insights drawn from various data sources, including remote sensing data, contribute to this understanding. Farahmand et al.&nbsp;(2012) employ remote sensing in monitoring drought, while models like the Global Land Data Assimilation System (GLDAS), as discussed by Rodell et al.&nbsp;(2004), utilize satellite and ground-based observations to provide real-time, high-resolution data on land surface states and fluxes, aiding in a more comprehensive understanding of drought and flooding.</p>
<section id="datasets" class="level2">
<h2 class="anchored" data-anchor-id="datasets">Datasets</h2>
<p>MODIS NRT, Geoboundaries, WSIM-GLDAS, GPW</p>
</section>
<section id="wsim-gldas" class="level2">
<h2 class="anchored" data-anchor-id="wsim-gldas">WSIM-GLDAS</h2>
<p>What is W-SIM-GLDAS …. text and images here explaining dataset and situating it within our water cycle narrative, how to access it, etc</p>
<p><strong>Generation and Collection (30 Minutes)</strong></p>
<p>Water stress and human impacts Datasets: MODIS NRT, Geoboundaries, WSIM-GLDAS, GPW</p>
<ul>
<li>How to access and download local data</li>
<li>How to connect to cloud based data services</li>
</ul>
<p><strong>Processing and Storage (30 Minutes)</strong></p>
<ul>
<li>In-memory storage: how to load small datasets in-memory</li>
<li>Local storage: how to download datasets locally</li>
<li>Cloud storage: how to download datasets into s3 buckets</li>
</ul>
<p><strong>Management and Analysis (30 Minutes)</strong></p>
<ul>
<li>How to rasterize vector data and control for extent and cell size: Harmonization by scale and extent</li>
<li>How to subset big data for AOI: Select by attribute or location</li>
<li>How to summarize raster data: Zonal statistics -Summarize CI OSM Hospitals, govt buildings, etc (impact of water disasters/phenomena)</li>
</ul>
<p><strong>Visualization and Interpretation (30 Minutes)</strong></p>
<ul>
<li>Create charts, maps</li>
<li>How to visualize and interpret a map</li>
<li>How to visualize and interpret a graph</li>
<li>How to think critically about analysis results</li>
</ul>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction">Introduction</h3>
<p>WSIM-GLDAS can be download from <a href="https://sedac.ciesin.columbia.edu/data/set/water-wsim-gldas-v1">SEDAC</a>. Downloads are organized by combination of variable (composite surplus/deficit, temperature, PETmE, runoff, soil moisture, precipitation) and integration period (1, 3, 6, 12 months). Each variable-integration combination consists of a NetCDF raster file with a time dimension that contains a raster layer for each of the 804 months between January, 1948 and December, 2014. Some variables also contain multiple attributes each with their own time dimension of 804 rasters. Hence, this is a large file that takes upwards of 2 hours to download and may cause memory issues on certain systems. We will work with the composite anomolies integrated over 1 month periods.</p>
</section>
<section id="reading-the-data" class="level3">
<h3 class="anchored" data-anchor-id="reading-the-data">Reading the Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars) <span class="co"># raster manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: abind</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># vector manipulation</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># advanced plotting</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># date/time manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(exactextractr) <span class="co"># zonal statistics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Start by reading in the downloaded file</p>
</section>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load Data</h3>
<p>Load in data from previous vignette.</p>
<p>I think the previous vignette should end with a 2000-2014 12-month integration CONUS dataset.</p>
<div class="cell">

</div>
</section>
<section id="view-data" class="level3">
<h3 class="anchored" data-anchor-id="view-data">View Data</h3>
<p>Verify data structure with <code>print</code> or <code>summary.</code></p>
<section id="exploratory-histogram" class="level4">
<h4 class="anchored" data-anchor-id="exploratory-histogram">Exploratory Histogram</h4>
<p>Create histogram of raster values for a single time step.</p>
<p>Basic plotting method is OK, but check if it can be done with <code>ggplot</code>so we can use a uniform palette across all modules.</p>
<div class="cell">

</div>
<p>Extreme values or other items of note might require additional visualization or other data exploration.</p>
</section>
<section id="multi-panel-time-series" class="level4">
<h4 class="anchored" data-anchor-id="multi-panel-time-series">Multi-Panel Time Series</h4>
<p>Create a multipanel time series of 12 month integration CONUSA; similar to what we used to identify our case studies. Each panel will represent 1 year.</p>
<p>Load in a CONUSA geojson from geoBoundaries. Copy methods from previous vignette.</p>
<div class="cell">

</div>
<p>Start with the basic plotting commands–create the time series with <code>slice</code> or other method used in previous vignette.</p>
<div class="cell">

</div>
<p>The palette will not exist and be difficult to use.</p>
<p>Try a built in palette for stars (not sure if possible?).</p>
<p>Introduce the official WSIM palette. This may only be helpful within a <code>ggplot</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># numbers are return period values for a composite surplus (blues) and deficit (reds) dataset</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>leg_colors<span class="ot">&lt;-</span><span class="fu">c</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#9B0039'</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -50 to -40</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#D44135'</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -40 to -20</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#FF8D43'</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -20 to -10</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#FFC754'</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -10 to -5</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#FFEDA3'</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -5 to -3</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#FFFFFF'</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># -3 to 3</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#CEFFAD'</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3 to 5</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#00F3B5'</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5 to 10</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#00CFCE'</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 10 to 20</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#009ADE'</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 20 to 40</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#0045B5'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once hot spots are easily identified pick a region of interest to zoom in on using the 1 month integration dataset.</p>
<p>Load in the 1 month integration dataset and subset/index the dataset to the region of interest (copy code from previous vignette). Use <code>dplyr::slice</code> or other method to pull out just the 12 months from the year of interest. Code demonstrating these techniques in previous vignette.</p>
<div class="cell">

</div>
<p>Create a multi-panel figure with each panel representing 1 month to identify the most intense months of drought or flooding. Starting with this one maybe use <code>ggplot</code> and a nice palette, legend, and panel headings. Will probably have to use some sort of faceting to make individual panels (might not be possible).</p>
<div class="cell">

</div>
</section>
</section>
<section id="use-case-background" class="level3">
<h3 class="anchored" data-anchor-id="use-case-background">Use Case Background</h3>
<p>Now that we’ve keyed in on a particular event, bring in the backup information we’ve collected to discuss what actually happened.</p>
</section>
<section id="point-location-time-series" class="level3">
<h3 class="anchored" data-anchor-id="point-location-time-series">Point Location Time Series</h3>
<p>Visualize an individual cell with particular extreme or maybe volatile values. Use Google Maps to identify the latitude/longitude of a place of interest. Maybe an urban center or other important location in the region that suffered from the extreme event.</p>
<p>Create a vector with the point location.</p>
<div class="cell">

</div>
<p>Use <code>stars::extract</code> to extract raster values in the stack at the point location.</p>
<div class="cell">

</div>
<p>The resulting data frame of time series values should be inspected. It may also need to be converted from wide format to long format so it may be plotted in <code>ggplot</code>. Use either pivot wider/longer from <code>dplyr</code> or cast/melt from <code>data.table</code>.</p>
<div class="cell">

</div>
<p>Once in the proper format, plot using <code>ggplot</code>.</p>
<div class="cell">

</div>
</section>
<section id="population-exposure-plot" class="level3">
<h3 class="anchored" data-anchor-id="population-exposure-plot">Population Exposure Plot</h3>
<p>Use Gridded Population of the World and <code>exactextractr</code> to determine the number of people exposed to a given anomaly for each month of the year.</p>
<p>Background info on GPW would be appropriate. Same with <code>exactextractr</code> and zonal statistics.</p>
<p>Load in GPW data and the <code>exactextractr</code> package</p>
<div class="cell">

</div>
<p>Perform the time series zonal summary.</p>
<p>This might be a bit tricky; been a while for me. Have to look up the proper code. Dan has good examples on the exactextractr package website.</p>
<p>Resulting data.frame will probably need to be transformed to long (just like before), so it can be plotted.</p>
<div class="cell">

</div>
<p>Now plot the data in ggplot. I have some existing code I can pull to help with the plotting–or at least make it ## MODIS NRT Global Flood Product</p>
<p><strong>Processing and Storage (30 Minutes)</strong></p>
<p><strong><em>In-memory storage: how to load small datasets in-memory</em></strong></p>
<ul>
<li>Local storage: how to download datasets locally</li>
<li>Cloud storage: how to download datasets into s3 buckets</li>
</ul>
<p><strong>Management and Analysis (30 Minutes)</strong></p>
<ul>
<li>How to rasterize vector data and control for extent and cell size: Harmonization by scale and extent</li>
<li>How to subset big data for AOI: Select by attribute or location</li>
<li>How to summarize raster data: Zonal statistics -Summarize CI OSM Hospitals, govt buildings, etc (impact of water disasters/phenomena)</li>
</ul>
<p><strong>Visualization and Interpretation (30 Minutes)</strong></p>
<ul>
<li>Create charts, maps</li>
<li>How to visualize and interpret a map</li>
<li>How to visualize and interpret a graph</li>
<li>How to think critically about analysis results</li>
</ul>
<p><strong>Open Science and Community Engagement (10 Minutes)</strong></p>
<ul>
<li>Share your results to the community.</li>
<li>How to sign up for Slack and post results for feedback.</li>
<li>How to post interoperable code to Binder? How to create visualizations and post to binder (other destinations?)</li>
</ul>
<p><strong>Conclusion</strong></p>
<p><strong>References</strong></p>
</section>
<section id="introduction-1" class="level3">
<h3 class="anchored" data-anchor-id="introduction-1">Introduction</h3>
<p>The MODIS/Aqua+Terra Global Flood Product L3 Near Real Time (NRT) 250m Global Flood Product (MCDWD_L3_NRT) (beta) provides daily maps of flooding globally. The product is provided over 3 compositing periods (1-day, 2-day, and 3-day) to minimize the impact of clouds and more rigorously identify flood water (the best composite will depend on the cloudiness for a particular event).</p>
<p><img src="https://www.earthdata.nasa.gov/sites/default/files/imported/Flood_mekong.png" alt="A hand in water" width="600"></p>
<p><a href="https://www.earthdata.nasa.gov/learn/find-data/near-real-time/modis-nrt-global-flood-product">NASA EARTHDATA</a></p>
<p><a href="https://cmr.earthdata.nasa.gov/search/concepts/C2018599131-LANCEMODIS.html">CRM SEARCH</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>packages_to_check <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"stars"</span>, <span class="st">"httr"</span>,<span class="st">"jsonlite"</span>, <span class="st">"ggplot2"</span>, <span class="st">"IRkernel"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check and install packages</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (package_name <span class="cf">in</span> packages_to_check) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>package_name <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(package_name)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Package"</span>, package_name, <span class="st">"installed.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Package"</span>, package_name, <span class="st">"is already installed.</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(package_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Package stars is already installed.
Package httr is already installed.
Package jsonlite is already installed.
Package ggplot2 is already installed.
Package IRkernel is already installed.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("stars")</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("httr")</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("jsonlite")</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(stars)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># library(httr)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># library(jsonlite)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-the-data-1" class="level3">
<h3 class="anchored" data-anchor-id="reading-the-data-1">Reading the Data</h3>
<section id="check-what-days-are-available-lance-nrt" class="level4">
<h4 class="anchored" data-anchor-id="check-what-days-are-available-lance-nrt">Check what days are available: <a href="https://nrt3.modaps.eosdis.nasa.gov/archive/allData/61/MCDWD_L3_F3_NRT/">LANCE NRT</a></h4>
<p>Based on availability, edit the year_day variable YYYY-DD. Example: ‘2022-01’</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#add year and date you want to search for (YYYY-DD, 2022-01)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>year_day <span class="ot">&lt;-</span> <span class="st">'2023-333'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="determine-tiles-of-interest-modis-nrt-tile-map" class="level4">
<h4 class="anchored" data-anchor-id="determine-tiles-of-interest-modis-nrt-tile-map">Determine tiles of interest: <a href="https://www.earthdata.nasa.gov/s3fs-public/2023-01/MCDWD_GlobalTileMapHoriz_Website_865x2250.jpg?VersionId=lOQ_j47U8T.j7UUqibD7SM63FVHjM_V5">MODIS NRT Tile Map</a></h4>
<p><img src="https://www.earthdata.nasa.gov/s3fs-public/2023-01/MCDWD_GlobalTileMapHoriz_Website_865x2250.jpg?VersionId=lOQ_j47U8T.j7UUqibD7SM63FVHjM_V5" alt="A hand in water" width="100%"></p>
<p>Based on availability, edit the tile_code variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#add tile code from the map above (written as h00v00)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tile_code <span class="ot">&lt;-</span> <span class="st">'h09v06'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is the NRT Flood F3 (MCDWD_L3_F3) API URL:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>API_URL <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">'https://nrt3.modaps.eosdis.nasa.gov/api/v2/content/details?products=MCDWD_L3_F3_NRT&amp;archiveSets=61&amp;temporalRanges='</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can combine the API URL above with the year_day provided and print the available datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pasting together URL and year_day</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(API_URL, year_day)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://nrt3.modaps.eosdis.nasa.gov/api/v2/content/details?products=MCDWD_L3_F3_NRT&amp;archiveSets=61&amp;temporalRanges=2023-333"</code></pre>
</div>
</div>
</section>
</section>
<section id="load-data-1" class="level3">
<h3 class="anchored" data-anchor-id="load-data-1">Load Data</h3>
<p>Access the NASA Earthdata with the GET function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the GET request</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check response status from the GET function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the response status</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">http_status</span>(response)<span class="sc">$</span>category <span class="sc">==</span> <span class="st">"Success"</span>) {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the response JSON</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">content</span>(response, <span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  data_parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(data)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter for the tile code</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  content_items <span class="ot">&lt;-</span> data_parsed<span class="sc">$</span>content[<span class="fu">grepl</span>(tile_code, data_parsed<span class="sc">$</span>content<span class="sc">$</span>name, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#content_items &lt;- data_parsed[grepl("h09v06", data_parsed$name, ignore.case = TRUE), ]</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Request failed with status code"</span>, <span class="fu">http_status</span>(response)<span class="sc">$</span>status_code)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(content_items)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    archiveSets      cksum    collections               dataDay
155          61 2765006508 modis-nrt-c6.1 2023-333 = 2023-11-29
                                                                                          downloadsLink
155 https://nrt3.modaps.eosdis.nasa.gov/api/v2/content/archives/MCDWD_L3_F3_NRT.A2023333.h09v06.061.tif
        fileId                           md5sum      mtime
155 2048046843 c2a116d6ced8588afdf38b85adb55789 1701311963
                                       name        products resourceType
155 MCDWD_L3_F3_NRT.A2023333.h09v06.061.tif MCDWD_L3_F3_NRT         File
                                                               self    size
155 /api/v2/content/details/MCDWD_L3_F3_NRT.A2023333.h09v06.061.tif 1197913</code></pre>
</div>
</div>
<p>Select the ‘downloadsLink’ URL item in the content_items list:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>download_link <span class="ot">&lt;-</span> content_items<span class="sc">$</span>downloadsLink</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(download_link)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://nrt3.modaps.eosdis.nasa.gov/api/v2/content/archives/MCDWD_L3_F3_NRT.A2023333.h09v06.061.tif"</code></pre>
</div>
</div>
<p>Use the “read_stars()” function from the “stars” R Library to read the geoTiff raster.<br> The raster is assigned to the “x” variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>raster_df <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(download_link)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: ignoring unrecognized unit: none</code></pre>
</div>
</div>
</section>
<section id="visualizing-nrt-flood-data" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-nrt-flood-data">Visualizing NRT Flood Data</h3>
<p>Plot the raster to quickly view it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(raster_df, <span class="at">axes =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>downsample set to 3</code></pre>
</div>
<div class="cell-output-display">
<p><img src="SCHOOL_module1_water2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="create-nrt-flood-classification" class="level4">
<h4 class="anchored" data-anchor-id="create-nrt-flood-classification">Create NRT Flood Classification</h4>
<p>Refer to the <a href="https://www.earthdata.nasa.gov/s3fs-public/2023-01/MCDWD_UserGuide_RevC.pdf">MODIS NRT Global Flood Product User Guide</a> for more information.</p>
<p>NRT Flood data has 5 classifications:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Code</th>
<th style="text-align: left;">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: left;">No Watxer</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: left;">Surface Water</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2</td>
<td style="text-align: left;">Recurring flood<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></td>
</tr>
<tr class="even">
<td style="text-align: center;">3</td>
<td style="text-align: left;">Flood (unusual)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">255</td>
<td style="text-align: left;">Insufficient data</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>classes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>)<span class="co">#does not include NA</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gray"</span>, <span class="st">"blue"</span>, <span class="st">"yellow"</span>,<span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the ggplot</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(raster_df, aes(x = x, y = y, fill = factor(class))) +</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "white", size = 0.1) +</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_manual(values = colors, breaks = as.character(classes), labels = as.character(classes)) +</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Raster Classification",</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#        fill = "Class") +</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate breaks based on the number of classes</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks &lt;- seq(min(classes), max(classes), length.out = length(classes) + 1)</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot the stars object with specific categories</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(x,axes=TRUE, col = colors, breaks = breaks, key.pos = 1, main = "Raster Plot with Specific Categories")</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add a legend for categories</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># legend("right", legend = classes, fill = colors, title = "Classes")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="credits" class="level1">
<h1>Credits</h1>
<section id="photos" class="level2">
<h2 class="anchored" data-anchor-id="photos">Photos</h2>
<p>Module 1 Banner Photo by Jacob Kelvin.</p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Value 2 (Recurring flood) is not populated in the beta release.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>